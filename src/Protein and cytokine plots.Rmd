---
title: "Plotting proteins and cytokines"
author: "Anna Österberg"
date: "2024-09-16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = TRUE,
                      warning = TRUE)
```

## Creating pdf's with barplots as well as boxplots (of each sample group) colored by groups of 
  -cytokines with highest loadings for PC1 and PC2 (24 hours after PEV treatment)
  -extracellular matrix structural constituent proteins (overrepresented protein group in molecular function ontology)
  -intracellular signal proteins (overrepresented protein group in Panther protein class)

```{r}
#Loading necessary libraries 
library(ggplot2)
library(dplyr)
library(tidyverse)
library(readxl)


#Loading cytokines and extracting the ones with highest loadings for PC1 and PC2
cyto_data <- read.csv("/home/aosterberg/Documents/DI_työ/cytokine24h.csv",header = TRUE)
colnames(cyto_data) <- c("secretome", "unstimulated_PEV_1", "unstimulated_PEV_2", "unstimulated_PEV_3", "unstimulated_PEV_4","GPVI_PEV_1", "GPVI_PEV_2", "GPVI_PEV_3", "GPVI_PEV_4", "CLEC2_PEV_1","CLEC2_PEV_2","CLEC2_PEV_3", "CLEC2_PEV_4", "TC_PEV_1","TC_PEV_2","TC_PEV_3", "TC_PEV_4", "no_PEV_1","no_PEV_2","no_PEV_3","no_PEV_4")
rownames(cyto_data) <- cyto_data[,1]
cyto_data <- cyto_data[,2:17]
top_cytokines <-cyto_data[c('Il-7','IL-1 alpha', 'MCP-1', 'MIP-1 alpha', 'MIP-1 beta', 'SDF-1 alpha'),]

#Plotting a single cytokine
plot_data <- data.frame(Sample = colnames(top_cytokines), Intensity = as.numeric(top_cytokines[1,]), Groups =  c("unstimulated", "unstimulated", "unstimulated", "unstimulated", "GPVI", "GPVI","GPVI", "GPVI", "CLEC2", "CLEC2", "CLEC2", "CLEC2","TC","TC","TC","TC"))
ggplot(plot_data, aes(x= Sample, y = Intensity,  fill = Groups))+ geom_bar(stat = "identity") + theme_minimal()+theme(axis.text.x = element_blank()) + labs(title = "IL-7")+ theme(plot.title = element_text(hjust=0.5, size =20))



#Formatting the dataframe for plotting
cytokines_long <- top_cytokines %>% 
                  rownames_to_column(var = "Cytokine") %>% 
                  pivot_longer(-Cytokine, names_to= "Sample", values_to = "Intensity")%>% 
                  mutate(Group=rep(c("Unstimulated", "Unstimulated", "Unstimulated", "Unstimulated", "GPVI", "GPVI","GPVI", "GPVI", "CLEC2", "CLEC2", "CLEC2", "CLEC2","TC","TC","TC","TC"), length  = 96))
                           
  
#Function for barplot of each cytokine colored by group
plot_cytokines <- function(name){
  cytokines_long %>% filter(Cytokine == name) %>% 
  ggplot(aes(x= Sample, y = Intensity,  fill = Group))+ geom_bar(stat="identity") + theme_minimal()+theme(axis.text.x = element_blank())+ labs(title = name)+ theme(plot.title = element_text(hjust=0.5, size =20))
  
}

#creating a list of cytokines and plotting each and saving in a pdf
cytokines <- unique(cytokines_long$Cytokine)

pdf("cytokine_plots.pdf")
for(cytokine in cytokines){
  print(plot_cytokines(cytokine))
}
dev.off()




#Creating dataframes for the overrepresented proteins to be plotted

prot_data <- read.csv("/home/aosterberg/Documents/DI_työ/PEVproteomics.csv",header = TRUE, dec = ",")
colnames(prot_data)<- c("protein", "unstimulated_PEV_1","unstimulated_PEV_2","unstimulated_PEV_3","GPVI_PEV_1", "GPVI_PEV_2", "GPVI_PEV_3", "CLEC2_PEV_1","CLEC2_PEV_2","CLEC2_PEV_3","TC_PEV_1","TC_PEV_2","TC_PEV_3")
rownames(prot_data) <- prot_data[,1]
prot_data <- prot_data[,2:13]
head(prot_data)

mol_func_prot <- prot_data[c('Transforming growth factor-beta-induced protein ig-h3', 'Nidogen-2','Latent-transforming growth factor beta-binding protein 1', 'Fibrinogen beta chain', 'Fibronectin', 'Extracellular matrix protein 1', 'Fibrinogen alpha chain', 'Nidogen-1', 'SPARC', 'Vitronectin'),]
print(mol_func_prot)
protein_class_prot <- prot_data[c('Connective tissue growth factor','Platelet-derived growth factor D', 'Angiopoietin-1', 'Fibrinogen beta chain', 'Platelet factor 4', 'Platelet basic protein', 'Platelet-derived growth factor subunit B', 'Platelet-derived growth factor subunit A'),]
protein_class_prot
prot_groups <- c("unstimulated", "unstimulated","unstimulated", "GPVI", "GPVI","GPVI", "CLEC2", "CLEC2", "CLEC2","TC","TC","TC")


#Formatting the dataframes for plotting
molfunc_long <- mol_func_prot %>% 
  rownames_to_column(var = "Protein") %>% 
  pivot_longer(-Protein, names_to= "Sample", values_to = "Abundance")%>% 
  mutate(Group=rep(c("Unstimulated", "Unstimulated", "Unstimulated", "GPVI", "GPVI","GPVI", "CLEC2", "CLEC2", "CLEC2","TC","TC","TC"), times  = 10))

protclass_long <- protein_class_prot %>% 
  rownames_to_column(var = "Protein") %>% 
  pivot_longer(-Protein, names_to= "Sample", values_to = "Abundance")%>% 
  mutate(Group=rep(c("Unstimulated", "Unstimulated", "Unstimulated", "GPVI", "GPVI","GPVI", "CLEC2", "CLEC2", "CLEC2","TC","TC","TC"), times  = 8))



#Function for barplot of each protein colored by group
plot_proteins <- function(df_long, name){
  df_long %>% filter(Protein == name) %>% 
  ggplot(aes(x= Sample, y = Abundance,  fill = Group))+ geom_bar(stat="identity") + theme_minimal()+theme(axis.text.x = element_blank())+ labs(title = name)+ theme(plot.title = element_text(hjust=0.5, size =15))
  
}

#Creating lists of proteins to be plotted and plotting them in a pdf

mol_func_proteins <- unique(molfunc_long$Protein)
prot_class_proteins <- unique(protclass_long$Protein)

pdf("mol_func_plots.pdf")
for(protein in mol_func_proteins){
  print(plot_proteins(molfunc_long,protein))
}
dev.off()


pdf("prot_class_plots.pdf")
for(protein in prot_class_proteins){
  print(plot_proteins(protclass_long,protein))
}
dev.off()

```
## Boxplots of proteins in overrepresented protein groups 

```{r}

#Function for barplot of each protein colored by group
boxplot_proteins <- function(df_long, name){
  df_long %>% filter(Protein == name) %>% 
  ggplot(aes(x= Group, y = Abundance,  fill = Group))+ geom_boxplot() + theme_minimal()+ labs(title = name)+ theme(plot.title = element_text(hjust=0.5, size =15))
  
}

#Creating lists of proteins to be plotted and plotting them in a pdf

mol_func_proteins <- unique(molfunc_long$Protein)
prot_class_proteins <- unique(protclass_long$Protein)


pdf("mol_func_boxplots.pdf")
for(protein in mol_func_proteins){
  print(boxplot_proteins(molfunc_long,protein))
}
dev.off()

pdf("prot_class_boxplots.pdf")
for(protein in prot_class_proteins){
  print(boxplot_proteins(protclass_long,protein))
}
dev.off()
```

## Loading cytokine after 6h and 24h separately and plotting all cytokines as barplots


```{r}
cytokine_6h <- read_excel("/home/aosterberg/Documents/DI_työ/data/TableS2.xlsx", sheet = 2) %>% as.data.frame()
print(cytokine_6h)

cytokine_24h <- read_excel("/home/aosterberg/Documents/DI_työ/data/TableS2.xlsx", sheet = 3) %>% as.data.frame()
print(cytokine_24h)
  
colnames(cytokine_6h) <- c("secretome", "unstimulated_PEV_1", "unstimulated_PEV_2", "unstimulated_PEV_3", "unstimulated_PEV_4","GPVI_PEV_1", "GPVI_PEV_2", "GPVI_PEV_3", "GPVI_PEV_4", "CLEC2_PEV_1","CLEC2_PEV_2","CLEC2_PEV_3", "CLEC2_PEV_4", "TC_PEV_1","TC_PEV_2","TC_PEV_3", "TC_PEV_4", "no_PEV_1","no_PEV_2","no_PEV_3","no_PEV_4")
rownames(cytokine_6h) <- cytokine_6h[,1]
cytokine_6h <- cytokine_6h[,2:17]

colnames(cytokine_24h) <- c("secretome", "unstimulated_PEV_1", "unstimulated_PEV_2", "unstimulated_PEV_3", "unstimulated_PEV_4","GPVI_PEV_1", "GPVI_PEV_2", "GPVI_PEV_3", "GPVI_PEV_4", "CLEC2_PEV_1","CLEC2_PEV_2","CLEC2_PEV_3", "CLEC2_PEV_4", "TC_PEV_1","TC_PEV_2","TC_PEV_3", "TC_PEV_4", "no_PEV_1","no_PEV_2","no_PEV_3","no_PEV_4")
rownames(cytokine_24h) <- cytokine_24h[,1]
cytokine_24h <- cytokine_24h[,2:17]
head(cytokine_6h)


#Formatting the dataframe for plotting
cytokines_long_6h <- cytokine_6h %>% 
                  rownames_to_column(var = "Cytokine") %>% 
                  pivot_longer(-Cytokine, names_to= "Sample", values_to = "Intensity")%>% 
                  mutate(Group=rep(c("Unstimulated", "Unstimulated", "Unstimulated", "Unstimulated", "GPVI", "GPVI","GPVI", "GPVI", "CLEC2", "CLEC2", "CLEC2", "CLEC2","TC","TC","TC","TC"), times  = 16))

cytokines_long_24h <- cytokine_24h %>% 
                  rownames_to_column(var = "Cytokine") %>% 
                  pivot_longer(-Cytokine, names_to= "Sample", values_to = "Intensity")%>% 
                  mutate(Group=rep(c("Unstimulated", "Unstimulated", "Unstimulated", "Unstimulated", "GPVI", "GPVI","GPVI", "GPVI", "CLEC2", "CLEC2", "CLEC2", "CLEC2","TC","TC","TC","TC"), times  = 16))

                           
  
#Function for barplot of each cytokine colored by group
plot_cytokines <- function(df_long,name){
  df_long %>% filter(Cytokine == name) %>% 
  ggplot(aes(x= Group, y = Intensity,  fill = Group))+ geom_boxplot() + theme_minimal()+theme(axis.text.x = element_blank())+ labs(title = name)+ theme(plot.title = element_text(hjust=0.5, size =20))
  
}

#creating a list of cytokines and plotting each and saving in a pdf
cytokines_6h <- unique(cytokines_long_6h$Cytokine)
cytokines_24h <-unique(cytokines_long_24h$Cytokine)


pdf("cytokine_boxplots_6h.pdf")
for(cytokine in cytokines_6h){
  print(plot_cytokines(cytokines_long_6h,cytokine))
}
dev.off()

pdf("cytokine_boxplots_24h.pdf")
for(cytokine in cytokines_24h){
  print(plot_cytokines(cytokines_long_24h,cytokine))
}
dev.off()

```

